<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>与游戏世界交互&amp;物理系统与碰撞-作业4 | 殷轲的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="与游戏世界交互&amp;物理系统与碰撞-作业4打飞碟项目要求 游戏有 n 个 round，每个 round 都包括10 次 trial； 每个 trial 的飞碟的色彩、大小、发射位置、速度、角度、同时出现的个数都可能不同。它们由该 round 的 ruler 控制； 每个 trial 的飞碟有随机性，总体难度随 round 上升； 鼠标点中得分，得分规则按色彩、大小、速度不同计算，规则可自由设定">
<meta property="og:type" content="article">
<meta property="og:title" content="与游戏世界交互&amp;物理系统与碰撞-作业4">
<meta property="og:url" content="http://example.com/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/index.html">
<meta property="og:site_name" content="殷轲的博客">
<meta property="og:description" content="与游戏世界交互&amp;物理系统与碰撞-作业4打飞碟项目要求 游戏有 n 个 round，每个 round 都包括10 次 trial； 每个 trial 的飞碟的色彩、大小、发射位置、速度、角度、同时出现的个数都可能不同。它们由该 round 的 ruler 控制； 每个 trial 的飞碟有随机性，总体难度随 round 上升； 鼠标点中得分，得分规则按色彩、大小、速度不同计算，规则可自由设定">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/1.png">
<meta property="article:published_time" content="2021-10-25T05:14:08.794Z">
<meta property="article:modified_time" content="2021-10-25T05:32:13.755Z">
<meta property="article:author" content="殷轲">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/1.png">
  
    <link rel="alternate" href="/atom.xml" title="殷轲的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">殷轲的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-3D游戏编程/2021-10-25-homework4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/" class="article-date">
  <time datetime="2021-10-25T05:14:08.794Z" itemprop="datePublished">2021-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      与游戏世界交互&amp;物理系统与碰撞-作业4
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="与游戏世界交互-amp-物理系统与碰撞-作业4"><a href="#与游戏世界交互-amp-物理系统与碰撞-作业4" class="headerlink" title="与游戏世界交互&amp;物理系统与碰撞-作业4"></a>与游戏世界交互&amp;物理系统与碰撞-作业4</h2><h2 id="打飞碟"><a href="#打飞碟" class="headerlink" title="打飞碟"></a><strong>打飞碟</strong></h2><h3 id="项目要求"><a href="#项目要求" class="headerlink" title="项目要求"></a><strong>项目要求</strong></h3><ul>
<li>游戏有 n 个 round，每个 round 都包括10 次 trial；</li>
<li>每个 trial 的飞碟的色彩、大小、发射位置、速度、角度、同时出现的个数都可能不同。它们由该 round 的 ruler 控制；</li>
<li>每个 trial 的飞碟有随机性，总体难度随 round 上升；</li>
<li>鼠标点中得分，得分规则按色彩、大小、速度不同计算，规则可自由设定  </li>
<li>使用带缓存的工厂模式管理不同飞碟的生产与回收，该工厂必须是场景单实例的！具体实现见参考资源 Singleton 模板类</li>
<li>近可能使用前面 MVC 结构实现人机交互与游戏模型分离  </li>
</ul>
<h3 id="游戏规则"><a href="#游戏规则" class="headerlink" title="游戏规则"></a><strong>游戏规则</strong></h3><ol>
<li>默认进行5round,每个round共有10trials，每个tiral间隔1秒随机发射1~3个飞碟，当所有飞碟发射完毕时游戏结束。  </li>
<li>开启Infinite后可突破默认5round限制，无限round。</li>
<li>开启Physis后可开启飞碟间物理碰撞，关闭Physis后可关闭飞碟间物理碰撞。</li>
<li>共有3种飞碟，体积：银色飞碟&gt;金色飞碟&gt;青色飞碟；速度：青色飞碟&gt;金色飞碟&gt;银色飞碟；得分：银色飞碟1分，金色飞碟2分，青色飞碟3分。</li>
<li>随着round数增加，高难度高得分飞碟占比增加，鼠标点击命中飞碟即得分。</li>
</ol>
<h4 id="图片展示"><a href="#图片展示" class="headerlink" title="图片展示"></a>图片展示</h4><img src="/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/1.png" class="">

<p><a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XNTgxNTU4NTM5Ng==.html">演示视频</a></p>
<iframe height=498 width=510 src='https://player.youku.com/embed/XNTgxNTU4NTM5Ng==' frameborder=0 'allowfullscreen'></iframe>

<p><a target="_blank" rel="noopener" href="https://github.com/Ink4396/3DGameHW/tree/master/%E6%89%93%E9%A3%9E%E7%A2%9F-%E4%B8%8E%E6%B8%B8%E6%88%8F%E4%B8%96%E7%95%8C%E4%BA%A4%E4%BA%92%26%E7%89%A9%E7%90%86%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A2%B0%E6%92%9E">项目下载</a></p>
<h4 id="代码核心部分说明"><a href="#代码核心部分说明" class="headerlink" title="代码核心部分说明"></a>代码核心部分说明</h4><h5 id="1-Singleton-cs"><a href="#1-Singleton-cs" class="headerlink" title="1.Singleton.cs"></a>1.Singleton.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt; : <span class="title">MonoBehaviour</span> <span class="keyword">where</span> <span class="title">T</span>: <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> T instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                instance = (T)FindObjectOfType(<span class="keyword">typeof</span>(T));</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.LogError(<span class="string">&quot;An instance of &quot;</span> + <span class="keyword">typeof</span>(T) + <span class="string">&quot; is needed in the scene, but there is none&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景单实例类，当所需的实例第一次被需要时，在场景内搜索该实例，下一次使用时不需要搜索直接返回。</p>
<h5 id="2-DiskData-cs"><a href="#2-DiskData-cs" class="headerlink" title="2.DiskData.cs"></a>2.DiskData.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DiskData</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed;         <span class="comment">//水平速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> points;          <span class="comment">//得分</span></span><br><span class="line">    <span class="keyword">public</span> Vector3 direction;   <span class="comment">//初始方向</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>飞碟数据，携带飞碟的飞行速度、得分、以及飞行方向</p>
<h5 id="3-DiskFactory-cs"><a href="#3-DiskFactory-cs" class="headerlink" title="3.DiskFactory.cs"></a>3.DiskFactory.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DiskFactory</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> GameObject disk_Prefab;              <span class="comment">//飞碟预制</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;DiskData&gt; used;                <span class="comment">//正被使用的飞碟</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DiskData&gt; free;                <span class="comment">//空闲的飞碟</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        used = <span class="keyword">new</span> List&lt;DiskData&gt;();</span><br><span class="line">        free = <span class="keyword">new</span> List&lt;DiskData&gt;();</span><br><span class="line">        disk_Prefab = GameObject.Instantiate&lt;GameObject&gt;(Resources.Load&lt;GameObject&gt;(<span class="string">&quot;Prefabs/Disk_Prefab&quot;</span>), Vector3.zero, Quaternion.identity);</span><br><span class="line">        disk_Prefab.SetActive(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetDisk</span>(<span class="params"><span class="keyword">int</span> round</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        GameObject disk;</span><br><span class="line">        <span class="comment">//如果有空闲的飞碟，则直接使用，否则生成一个新的</span></span><br><span class="line">        <span class="keyword">if</span> (free.Count &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            disk = free[<span class="number">0</span>].gameObject;</span><br><span class="line">            disk.transform.localEulerAngles = Vector3.zero;</span><br><span class="line">            free.Remove(free[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            disk = GameObject.Instantiate&lt;GameObject&gt;(disk_Prefab, Vector3.zero, Quaternion.identity);</span><br><span class="line">            disk.AddComponent&lt;DiskData&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照round来设置飞碟属性</span></span><br><span class="line">        <span class="comment">//飞碟的等级 = 0~3之间的随机数 * 轮次数</span></span><br><span class="line">        <span class="comment">//0~4:  铜色飞碟  </span></span><br><span class="line">        <span class="comment">//4~7:  银色飞碟  </span></span><br><span class="line">        <span class="comment">//7~10: 金色飞碟</span></span><br><span class="line">        <span class="keyword">float</span> level = UnityEngine.Random.Range(<span class="number">0</span>, <span class="number">3f</span>) * (round + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (level &lt; <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().points = <span class="number">1</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().speed = <span class="number">4.0f</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().direction = <span class="keyword">new</span> Vector3(GetRandomInt(<span class="number">-16</span>,<span class="number">16</span>), <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            disk.GetComponent&lt;Renderer&gt;().material.color = Color.grey;</span><br><span class="line">            disk.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">6.5f</span>, <span class="number">0.8f</span>, <span class="number">6.5f</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (level &gt; <span class="number">7</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().points = <span class="number">3</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().speed = <span class="number">8.0f</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().direction = <span class="keyword">new</span> Vector3(GetRandomInt(<span class="number">-16</span>, <span class="number">16</span>), <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            disk.GetComponent&lt;Renderer&gt;().material.color = Color.cyan;</span><br><span class="line">            disk.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">2.5f</span>, <span class="number">0.4f</span>, <span class="number">2.5f</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().points = <span class="number">2</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().speed = <span class="number">6.0f</span>;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().direction = <span class="keyword">new</span> Vector3(GetRandomInt(<span class="number">-16</span>, <span class="number">16</span>), <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            disk.GetComponent&lt;Renderer&gt;().material.color = Color.yellow;</span><br><span class="line">            disk.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">4.5f</span>, <span class="number">0.6f</span>, <span class="number">4.5f</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        used.Add(disk.GetComponent&lt;DiskData&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> disk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetRandomInt</span>(<span class="params"><span class="keyword">int</span> min,<span class="keyword">int</span> max</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">int</span> tmp_min=min,tmp_max=max;</span><br><span class="line">        <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp_max = max / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> (tmp_max + tmp_min) / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    tmp_max = tmp_max / <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> (tmp_max + tmp_min) / <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">return</span> tmp_max;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">return</span> max;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            tmp_min = min / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> (tmp_min + tmp_max) / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    tmp_min = tmp_min / <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> (tmp_max + tmp_min) / <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (UnityEngine.Random.Range(<span class="number">-1f</span>, <span class="number">1f</span>) &gt; <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">return</span> tmp_min;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">return</span> min;</span><br><span class="line">                &#125;     </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeDisk</span>(<span class="params">GameObject disk</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//找到使用中的飞碟，将其踢出并加入到空闲队列</span></span><br><span class="line">        <span class="keyword">foreach</span> (DiskData diskData <span class="keyword">in</span> used)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (diskData.gameObject.GetInstanceID() == disk.GetInstanceID())</span><br><span class="line">            &#123;</span><br><span class="line">                disk.SetActive(<span class="literal">false</span>);</span><br><span class="line">                free.Add(diskData);</span><br><span class="line">                used.Remove(diskData);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>飞碟工厂，负责生产与释放飞碟。  </p>
<ul>
<li>GetDisk:<br>GetDisk用于生产飞碟，首先从free空闲队列中查找是否有可用的飞碟，如果没有则新建一个飞碟。<br>飞碟属性的设置依赖轮次数，将一个0~3之间的随机数乘以轮次数获得level，再根据level来设置属性。<br>这样就具有了轮次越多优质飞碟越多的特性，且前期不会产生高分飞碟。</li>
<li>FreeDisk:<br>FreeDisk用于释放飞碟，将飞碟从used队列中移除并添加到free队列中。</li>
</ul>
<h5 id="4-SSAction-cs"><a href="#4-SSAction-cs" class="headerlink" title="4.SSAction.cs"></a>4.SSAction.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SSAction</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> enable = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> destroy = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject gameObject &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Transform transform &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> ISSActionCallback callback &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SSAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> System.NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> System.NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动作的基类</p>
<h5 id="5-CCFlyAction-cs"><a href="#5-CCFlyAction-cs" class="headerlink" title="5.CCFlyAction.cs"></a>5.CCFlyAction.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CCFlyAction</span> : <span class="title">SSAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> gravity;          <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">float</span> speed;            <span class="comment">//水平速度</span></span><br><span class="line">    Vector3 direction;      <span class="comment">//飞行方向</span></span><br><span class="line">    <span class="keyword">float</span> time;             <span class="comment">//时间</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//生产函数(工厂模式)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CCFlyAction <span class="title">GetSSAction</span>(<span class="params">Vector3 direction, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        CCFlyAction action = ScriptableObject.CreateInstance&lt;CCFlyAction&gt;();</span><br><span class="line">        action.gravity = <span class="number">9.8f</span>;</span><br><span class="line">        action.time = <span class="number">0</span>;</span><br><span class="line">        action.speed = speed;</span><br><span class="line">        action.direction = direction;</span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        gameObject.GetComponent&lt;Rigidbody&gt;().isKinematic = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        time += Time.deltaTime;</span><br><span class="line">        transform.Translate(Vector3.down * gravity * time * Time.deltaTime);</span><br><span class="line">        transform.Translate(direction * speed * Time.deltaTime);</span><br><span class="line">        <span class="comment">//如果飞碟到达底部，则动作结束，进行回调</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.transform.position.y &lt; <span class="number">-10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.destroy = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.enable = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.callback.SSActionEvent(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>飞行动作，将飞行拆分成水平和垂直两个方向的运动，水平速度恒定，垂直方向施加重力加速度。<br>当飞碟到达底部时，动作结束，将进行回调</p>
<h5 id="6-ISSActionCallback-cs"><a href="#6-ISSActionCallback-cs" class="headerlink" title="6.ISSActionCallback.cs"></a>6.ISSActionCallback.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISSActionCallback</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//回调函数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SSActionEvent</span>(<span class="params">SSAction source,</span></span></span><br><span class="line"><span class="function"><span class="params">        SSActionEventType events = SSActionEventType.Competed,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> intParam = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">string</span> strParam = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        Object objectParam = <span class="literal">null</span></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回调函数接口</p>
<h5 id="7-SSActionManager-cs"><a href="#7-SSActionManager-cs" class="headerlink" title="7.SSActionManager.cs"></a>7.SSActionManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SSActionManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//动作集，以字典形式存在</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Dictionary</span>&lt;<span class="title">int</span>, <span class="title">SSAction</span>&gt; actions</span> = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">int</span>, SSAction&gt;();</span><br><span class="line">    <span class="comment">//等待被加入的动作队列(动作即将开始)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">SSAction</span>&gt; waitingAdd</span> = <span class="keyword">new</span> List&lt;SSAction&gt;();</span><br><span class="line">    <span class="comment">//等待被删除的动作队列(动作已完成)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">int</span>&gt; waitingDelete</span> = <span class="keyword">new</span> List&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//将waitingAdd中的动作保存</span></span><br><span class="line">        <span class="keyword">foreach</span> (SSAction ac <span class="keyword">in</span> waitingAdd)</span><br><span class="line">            actions[ac.GetInstanceID()] = ac;</span><br><span class="line">        waitingAdd.Clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//运行被保存的事件</span></span><br><span class="line">        <span class="keyword">foreach</span> (KeyValuePair&lt;<span class="keyword">int</span>, SSAction&gt; kv <span class="keyword">in</span> actions)</span><br><span class="line">        &#123;</span><br><span class="line">            SSAction ac = kv.Value;</span><br><span class="line">            <span class="keyword">if</span> (ac.destroy)</span><br><span class="line">            &#123;</span><br><span class="line">                waitingDelete.Add(ac.GetInstanceID());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ac.enable)</span><br><span class="line">            &#123;</span><br><span class="line">                ac.Update();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//销毁waitingDelete中的动作</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">int</span> key <span class="keyword">in</span> waitingDelete)</span><br><span class="line">        &#123;</span><br><span class="line">            SSAction ac = actions[key];</span><br><span class="line">            actions.Remove(key);</span><br><span class="line">            Destroy(ac);</span><br><span class="line">        &#125;</span><br><span class="line">        waitingDelete.Clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//准备运行一个动作，将动作初始化，并加入到waitingAdd</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RunAction</span>(<span class="params">GameObject gameObject, SSAction action, ISSActionCallback manager</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        action.gameObject = gameObject;</span><br><span class="line">        action.transform = gameObject.transform;</span><br><span class="line">        action.callback = manager;</span><br><span class="line">        waitingAdd.Add(action);</span><br><span class="line">        action.Start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动作管理者的基类</p>
<h5 id="8-CCActionManager-cs"><a href="#8-CCActionManager-cs" class="headerlink" title="8.CCActionManager.cs"></a>8.CCActionManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CCActionManager</span> : <span class="title">SSActionManager</span>, <span class="title">ISSActionCallback</span>, <span class="title">IActionManager</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//飞行动作</span></span><br><span class="line">    CCFlyAction flyAction;</span><br><span class="line">    <span class="comment">//控制器</span></span><br><span class="line">    FirstController controller;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> new <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        controller = (FirstController)SSDirector.GetInstance().CurrentScenceController;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fly</span>(<span class="params">GameObject disk, <span class="keyword">float</span> speed, Vector3 direction</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        flyAction = CCFlyAction.GetSSAction(direction, speed);</span><br><span class="line">        RunAction(disk, flyAction, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//回调函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SSActionEvent</span>(<span class="params">SSAction source,</span></span></span><br><span class="line"><span class="function"><span class="params">    SSActionEventType events = SSActionEventType.Competed,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> intParam = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">string</span> strParam = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    Object objectParam = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//飞碟结束飞行后进行回收</span></span><br><span class="line">        controller.FreeDisk(source.gameObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>飞行动作管理者，负责生成飞行动作，并接受飞行动作的回调信息，使飞碟被回收。</p>
<h5 id="9-IUserAction-cs"><a href="#9-IUserAction-cs" class="headerlink" title="9.IUserAction.cs"></a>9.IUserAction.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetFlyMode</span>(<span class="params"><span class="keyword">bool</span> isPhysis</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Hit</span>(<span class="params">Vector3 position</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetMode</span>(<span class="params"><span class="keyword">bool</span> isInfinite</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户动作接口，提供点击、重置、选择模式三个函数的接口。</p>
<h5 id="10-SSDirector-cs"><a href="#10-SSDirector-cs" class="headerlink" title="10.SSDirector.cs"></a>10.SSDirector.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SSDirector</span> : <span class="title">System.Object</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SSDirector _instance;</span><br><span class="line">    <span class="keyword">public</span> ISceneController CurrentScenceController &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SSDirector <span class="title">GetInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _instance = <span class="keyword">new</span> SSDirector();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>导演类</p>
<h5 id="11-ISceneController-cs"><a href="#11-ISceneController-cs" class="headerlink" title="11.ISceneController.cs"></a>11.ISceneController.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISceneController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadResources</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景控制类接口，与之前项目用途一致。</p>
<h5 id="12-FirstController-cs"><a href="#12-FirstController-cs" class="headerlink" title="12.FirstController.cs"></a>12.FirstController.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FirstController</span> : <span class="title">MonoBehaviour</span>, <span class="title">ISceneController</span>, <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    DiskFactory diskFactory;                         <span class="comment">//飞碟工厂</span></span><br><span class="line">    RoundController roundController;</span><br><span class="line">    UserGUI userGUI;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SSDirector.GetInstance().CurrentScenceController = <span class="keyword">this</span>;</span><br><span class="line">        gameObject.AddComponent&lt;DiskFactory&gt;();</span><br><span class="line">        gameObject.AddComponent&lt;CCActionManager&gt;();</span><br><span class="line">        gameObject.AddComponent&lt;PhysisActionManager&gt;();</span><br><span class="line">        gameObject.AddComponent&lt;RoundController&gt;();</span><br><span class="line">        gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">        LoadResources();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadResources</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        diskFactory = Singleton&lt;DiskFactory&gt;.Instance;</span><br><span class="line">        roundController = Singleton&lt;RoundController&gt;.Instance;</span><br><span class="line">        userGUI = Singleton&lt;UserGUI&gt;.Instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hit</span>(<span class="params">Vector3 position</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Camera ca = Camera.main;</span><br><span class="line">        Ray ray = ca.ScreenPointToRay(position);</span><br><span class="line"></span><br><span class="line">        RaycastHit[] hits;</span><br><span class="line">        hits = Physics.RaycastAll(ray);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RaycastHit hit = hits[i];</span><br><span class="line">            <span class="keyword">if</span> (hit.collider.gameObject.GetComponent&lt;DiskData&gt;() != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//将飞碟移至底端，触发飞行动作的回调</span></span><br><span class="line">                hit.collider.gameObject.transform.position = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">-110</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="comment">//积分</span></span><br><span class="line">                roundController.Record(hit.collider.gameObject.GetComponent&lt;DiskData&gt;());</span><br><span class="line">                <span class="comment">//更新GUI数据</span></span><br><span class="line">                userGUI.SetPoints(roundController.GetPoints());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        userGUI.SetMessage(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        userGUI.SetPoints(<span class="number">0</span>);</span><br><span class="line">        roundController.Reset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMode</span>(<span class="params"><span class="keyword">bool</span> isInfinite</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        roundController.SetMode(isInfinite);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetFlyMode</span>(<span class="params"><span class="keyword">bool</span> isPhysis</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        roundController.SetFlyMode(isPhysis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeDisk</span>(<span class="params">GameObject disk</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        diskFactory.FreeDisk(disk);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景控制器，负责游戏主要逻辑。  </p>
<ul>
<li>SendDisk:<br>SendDisk用于发射一个飞碟，首先从工厂获得一个飞碟，再为其设置初始位置和飞行动作。  </li>
<li>Hit:<br>Hit用于处理用户的点击动作，将用户点击到的飞碟移除，并计算分数。  </li>
<li>Restart:<br>Restart用于重置游戏。  </li>
<li>Update:<br>Update用于发射飞碟与更新状态，飞碟每1s发射一次，每次最多3只，当飞碟发射完毕后判断是否重置或者结束游戏。</li>
</ul>
<h5 id="13-UserGUI-cs"><a href="#13-UserGUI-cs" class="headerlink" title="13.UserGUI.cs"></a>13.UserGUI.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    IUserAction userAction;</span><br><span class="line">    <span class="keyword">string</span> roundMessage;</span><br><span class="line">    <span class="keyword">string</span> gameMessage;</span><br><span class="line">    <span class="keyword">string</span> curMode;</span><br><span class="line">    <span class="keyword">string</span> curInfinite;</span><br><span class="line">    <span class="keyword">bool</span> isfly;</span><br><span class="line">    <span class="keyword">bool</span> isInfinite;</span><br><span class="line">    <span class="keyword">int</span> points;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetroundMessage</span>(<span class="params"><span class="keyword">string</span> roundMessage</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.roundMessage = roundMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMessage</span>(<span class="params"><span class="keyword">string</span> gameMessage</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.gameMessage = gameMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetcurMode</span>(<span class="params"><span class="keyword">string</span> curMode</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.curMode = curMode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetcurInfinite</span>(<span class="params"><span class="keyword">string</span> curInfinite</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.curInfinite = curInfinite;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPoints</span>(<span class="params"><span class="keyword">int</span> points</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.points = points;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        points = <span class="number">0</span>;</span><br><span class="line">        roundMessage = <span class="string">&quot;Hit UFO&quot;</span>;</span><br><span class="line">        gameMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        curMode = <span class="string">&quot;off&quot;</span>;</span><br><span class="line">        curInfinite = <span class="string">&quot;off&quot;</span>;</span><br><span class="line">        isfly = <span class="literal">false</span>;</span><br><span class="line">        userAction = SSDirector.GetInstance().CurrentScenceController <span class="keyword">as</span> IUserAction;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//小字体初始化</span></span><br><span class="line">        GUIStyle style = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        style.normal.textColor = Color.white;</span><br><span class="line">        style.fontSize = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//大字体初始化</span></span><br><span class="line">        GUIStyle bigStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        bigStyle.normal.textColor = Color.white;</span><br><span class="line">        bigStyle.fontSize = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">        GUI.Label(<span class="keyword">new</span> Rect(<span class="number">300</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">200</span>), roundMessage, bigStyle);</span><br><span class="line">        GUI.Label(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">&quot;Points: &quot;</span> + points, style);</span><br><span class="line">        GUI.Label(<span class="keyword">new</span> Rect(<span class="number">310</span>, <span class="number">100</span>, <span class="number">50</span>, <span class="number">200</span>), gameMessage, style);</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">40</span>), <span class="string">&quot;Restart&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            userAction.Restart();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">40</span>), <span class="string">&quot;Infinite &quot;</span>+curInfinite))</span><br><span class="line">        &#123;</span><br><span class="line">            isInfinite = !isInfinite;</span><br><span class="line">            userAction.SetMode(isInfinite);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">40</span>), <span class="string">&quot;Physis &quot;</span>+curMode))</span><br><span class="line">        &#123;</span><br><span class="line">            isfly = !isfly;</span><br><span class="line">            userAction.SetFlyMode(isfly);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Input.GetButtonDown(<span class="string">&quot;Fire1&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            userAction.Hit(Input.mousePosition);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>界面类，构建UI并捕捉用户动作。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_20549085/article/details/102540163">参考博客</a></p>
<h4 id="发现的问题与改进措施"><a href="#发现的问题与改进措施" class="headerlink" title="发现的问题与改进措施"></a>发现的问题与改进措施</h4><pre><code>根据项目要求重新设置了round和trials，并且为不同难度飞碟重新设置了scale
原博客虽然设计了Physis切换，但是并非实时切换，而且重复切换后回收飞碟再使用时没有重置rotation,导致飞碟轨迹异常
改进中将多个按钮重置为了可开闭的切换模式开关，并且在飞碟工厂的回收中重置了rotation
原博客中OnGUI中GetButtonDown出现了鼠标点击一次响应多次的问题，导致得分异常，出现一次点击飞碟被多次计算得分的异常
分析原因是OnGUI按帧响应，将GetButtonDown移动到Update()中解决问题</code></pre>
<p>25 Oct 2021</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/" data-id="ckv67vrk60000nkv5cw0s78e0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          模型与动画-作业5
        
      </div>
    </a>
  
  
    <a href="/2021/10/16/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-16-homework3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">游戏对象与图形基础-作业3</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%AF%BC%E8%AE%BA/">软件工程导论</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/27/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-27-homework6/">UI系统-作业6</a>
          </li>
        
          <li>
            <a href="/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/">模型与动画-作业5</a>
          </li>
        
          <li>
            <a href="/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/">与游戏世界交互&amp;物理系统与碰撞-作业4</a>
          </li>
        
          <li>
            <a href="/2021/10/16/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-16-homework3/">游戏对象与图形基础-作业3</a>
          </li>
        
          <li>
            <a href="/2021/10/06/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-06-homework2/">游戏对象与图形基础-作业2</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 殷轲<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>