<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>模型与动画-作业5 | 殷轲的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="模型与动画-作业5巡逻兵项目要求 创建一个地图和若干巡逻兵(使用动画)； 每个巡逻兵走一个3~5个边的凸多边型，位置数据是相对地址。即每次确定下一个目标位置，用自己当前位置为原点计算； 巡逻兵碰撞到障碍物，则会自动选下一个点为目标； 巡逻兵在设定范围内感知到玩家，会自动追击玩家； 失去玩家目标后，继续巡逻； 计分：玩家每次甩掉一个巡逻兵计一分，与巡逻兵碰撞游戏结束；  个人修改： 计分：玩家每在出">
<meta property="og:type" content="article">
<meta property="og:title" content="模型与动画-作业5">
<meta property="og:url" content="http://example.com/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/index.html">
<meta property="og:site_name" content="殷轲的博客">
<meta property="og:description" content="模型与动画-作业5巡逻兵项目要求 创建一个地图和若干巡逻兵(使用动画)； 每个巡逻兵走一个3~5个边的凸多边型，位置数据是相对地址。即每次确定下一个目标位置，用自己当前位置为原点计算； 巡逻兵碰撞到障碍物，则会自动选下一个点为目标； 巡逻兵在设定范围内感知到玩家，会自动追击玩家； 失去玩家目标后，继续巡逻； 计分：玩家每次甩掉一个巡逻兵计一分，与巡逻兵碰撞游戏结束；  个人修改： 计分：玩家每在出">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-12-02T03:01:17.276Z">
<meta property="article:modified_time" content="2021-12-02T03:03:55.503Z">
<meta property="article:author" content="殷轲">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="殷轲的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">殷轲的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-3D游戏编程/2021-12-02-homework5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/" class="article-date">
  <time datetime="2021-12-02T03:01:17.276Z" itemprop="datePublished">2021-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      模型与动画-作业5
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="模型与动画-作业5"><a href="#模型与动画-作业5" class="headerlink" title="模型与动画-作业5"></a>模型与动画-作业5</h2><h2 id="巡逻兵"><a href="#巡逻兵" class="headerlink" title="巡逻兵"></a><strong>巡逻兵</strong></h2><h3 id="项目要求"><a href="#项目要求" class="headerlink" title="项目要求"></a><strong>项目要求</strong></h3><ul>
<li>创建一个地图和若干巡逻兵(使用动画)；</li>
<li>每个巡逻兵走一个3~5个边的凸多边型，位置数据是相对地址。即每次确定下一个目标位置，用自己当前位置为原点计算；</li>
<li>巡逻兵碰撞到障碍物，则会自动选下一个点为目标；</li>
<li>巡逻兵在设定范围内感知到玩家，会自动追击玩家；</li>
<li>失去玩家目标后，继续巡逻；</li>
<li>计分：玩家每次甩掉一个巡逻兵计一分，与巡逻兵碰撞游戏结束；</li>
</ul>
<p>个人修改：</p>
<p>计分：玩家每在出生点外的区域存活一秒计一分，玩家被巡逻兵攻击三次游戏结束; </p>
<p><a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XNTgyNDAzMjY0OA==.html">演示视频</a></p>
<iframe height=498 width=510 src='https://player.youku.com/embed/XNTgyNDAzMjY0OA==' frameborder=0 'allowfullscreen'></iframe>

<h3 id="代码部分说明"><a href="#代码部分说明" class="headerlink" title="代码部分说明"></a>代码部分说明</h3><ul>
<li><h3 id="用户交互"><a href="#用户交互" class="headerlink" title="用户交互:"></a><strong>用户交互</strong>:</h3><ul>
<li>UserGUI<br>  UserGUI用于接收玩家交互信息并显示一些画面<br>  UserGUI会将玩家当前血量、分数显示在屏幕上<br>  当玩家触发相应操作时，UserGUI会将信息传给控制器  <h5 id="1-UserGUI-cs"><a href="#1-UserGUI-cs" class="headerlink" title="1.UserGUI.cs"></a>1.UserGUI.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	IUserAction userAction;             <span class="comment">//控制器接口</span></span><br><span class="line">	<span class="keyword">int</span> points;                         <span class="comment">//分数</span></span><br><span class="line">	<span class="keyword">int</span> playerHealth;                   <span class="comment">//玩家血量</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> gameOver;               <span class="comment">//是否游戏结束</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//增加分数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddPoints</span>(<span class="params"><span class="keyword">int</span> points</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">this</span>.points += points;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置分数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPoints</span>(<span class="params"><span class="keyword">int</span> points</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">this</span>.points = points;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置玩家血量</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPlayerHealth</span>(<span class="params"><span class="keyword">int</span> health</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		playerHealth = health;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		gameOver = <span class="literal">false</span>;</span><br><span class="line">		points = <span class="number">0</span>;</span><br><span class="line">		userAction = SSDirector.GetInstance().CurrentScenceController <span class="keyword">as</span> IUserAction;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">//小字体初始化</span></span><br><span class="line">		GUIStyle style = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">		style.normal.textColor = Color.white;</span><br><span class="line">		style.fontSize = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//大字体初始化</span></span><br><span class="line">		GUIStyle bigStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">		bigStyle.normal.textColor = Color.white;</span><br><span class="line">		bigStyle.fontSize = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">		GUI.Label(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">50</span>), <span class="string">&quot;Health: &quot;</span> + playerHealth, style);</span><br><span class="line">		GUI.Label(<span class="keyword">new</span> Rect(<span class="number">20</span>, <span class="number">60</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">&quot;Points: &quot;</span> + points, style);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//显示游戏结束画面</span></span><br><span class="line">		<span class="keyword">if</span> (gameOver)</span><br><span class="line">		&#123;</span><br><span class="line">			GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">100</span>, Screen.height / <span class="number">2</span> - <span class="number">100</span>, <span class="number">200</span>, <span class="number">50</span>), <span class="string">&quot;You Die !&quot;</span>, bigStyle);</span><br><span class="line">			<span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">100</span>, Screen.height / <span class="number">2</span>, <span class="number">200</span>, <span class="number">50</span>), <span class="string">&quot;Restart&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				userAction.Restart();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//获得玩家移动操作</span></span><br><span class="line">		<span class="keyword">float</span> speed = Input.GetAxis(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line">		<span class="keyword">float</span> direction = Input.GetAxis(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line">		userAction.MovePlayer(speed, direction);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h3 id="玩家管理"><a href="#玩家管理" class="headerlink" title="玩家管理"></a><strong>玩家管理</strong></h3><ul>
<li>PlayerManager<br>  PlayerManager管理玩家的信息以及动画操作，提供订阅接口<br>  当玩家受伤时将事件发布出去，又订阅者进行处理<br>  当接收到Monster的攻击判定时判定是否符合受伤条件<br>  提供一些冷却机制，提高游戏可玩性 <h5 id="2-PlayerManager-cs"><a href="#2-PlayerManager-cs" class="headerlink" title="2.PlayerManager.cs"></a>2.PlayerManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">DealDamage</span>(<span class="params">GameObject player</span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> DealDamage dealDamage;              <span class="comment">//受伤事件发布</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> speed;             <span class="comment">//当前速度</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> direction;         <span class="comment">//当前方向位移</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> moveable;           <span class="comment">//是否可移动          </span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> health;              <span class="comment">//当前血量</span></span><br><span class="line">	<span class="keyword">float</span> damageCounter;            <span class="comment">//受伤保护计数器</span></span><br><span class="line"></span><br><span class="line">	Animator animator;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		animator = gameObject.GetComponent&lt;Animator&gt;();</span><br><span class="line">		speed = <span class="number">0</span>;</span><br><span class="line">		direction = <span class="number">0</span>;</span><br><span class="line">		damageCounter = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置速度(动画)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSpeed</span>(<span class="params"><span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		animator.SetFloat(<span class="string">&quot;speed&quot;</span>, speed);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//死亡</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Die</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		animator.SetBool(<span class="string">&quot;alive&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">		animator.SetTrigger(<span class="string">&quot;die&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//归位</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		animator.SetTrigger(<span class="string">&quot;restart&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断动画状态</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsName</span>(<span class="params"><span class="keyword">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>).IsName(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复活</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Revive</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Restart();</span><br><span class="line">		animator.SetBool(<span class="string">&quot;alive&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//受伤判定</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter</span>(<span class="params">Collider other</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">//如果接受到怪兽的攻击Trigger判定则进行处理</span></span><br><span class="line">		<span class="keyword">if</span> (other.gameObject.name == <span class="string">&quot;AttackRange&quot;</span> &amp;&amp; damageCounter &gt; <span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			MonsterManager parentManager = other.gameObject.GetComponentInParent&lt;MonsterManager&gt;();</span><br><span class="line">			<span class="comment">//只有怪兽攻击时Trigger有效，避免误判</span></span><br><span class="line">			<span class="keyword">if</span> (!parentManager.IsName(<span class="string">&quot;Z_Attack&quot;</span>))</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			damageCounter = <span class="number">0</span>;</span><br><span class="line">			health--;</span><br><span class="line">			<span class="keyword">if</span> (health &lt;= <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				Die();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//发布受伤事件</span></span><br><span class="line">			dealDamage(gameObject);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">//及时进行归位消除</span></span><br><span class="line">		<span class="keyword">if</span> (!IsName(<span class="string">&quot;die&quot;</span>))</span><br><span class="line">			animator.ResetTrigger(<span class="string">&quot;restart&quot;</span>);</span><br><span class="line">		damageCounter = (damageCounter + Time.deltaTime) &gt; <span class="number">5</span> ? <span class="number">5</span> : damageCounter + Time.deltaTime;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="怪兽管理"><a href="#怪兽管理" class="headerlink" title="怪兽管理"></a><strong>怪兽管理</strong></h3><ul>
<li><p>MonsterManager<br>  MonsterManager管理怪兽信息与动画操作，提供订阅操作<br>  当Monster与玩家碰撞时触发攻击事件   </p>
<h5 id="3-MonsterManager-cs"><a href="#3-MonsterManager-cs" class="headerlink" title="3.MonsterManager.cs"></a>3.MonsterManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonsterManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> moveable;           <span class="comment">//释放可移动</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> stop;               <span class="comment">//释放暂停移动</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> change;             <span class="comment">//需要改变方向</span></span><br><span class="line">	Animator animator;</span><br><span class="line">	FollowManager followManager;</span><br><span class="line">	<span class="keyword">float</span> hitCounter;               <span class="comment">//攻击冷却</span></span><br><span class="line">	<span class="keyword">float</span> collisionCounter;         <span class="comment">//撞墙冷却</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		moveable = <span class="literal">false</span>;</span><br><span class="line">		animator = gameObject.GetComponent&lt;Animator&gt;();</span><br><span class="line">		followManager = gameObject.GetComponent&lt;FollowManager&gt;();</span><br><span class="line">		collisionCounter = <span class="number">0</span>;</span><br><span class="line">		stop = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置速度(动画)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSpeed</span>(<span class="params"><span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		animator.SetFloat(<span class="string">&quot;speed&quot;</span>, speed);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//攻击</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		animator.SetTrigger(<span class="string">&quot;Attack&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//归位</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		animator.SetTrigger(<span class="string">&quot;restart&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断动画状态</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsName</span>(<span class="params"><span class="keyword">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">return</span> animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>).IsName(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//碰撞事件，与玩家碰撞时触发攻击操作，撞墙时改变方向</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnCollisionStay</span>(<span class="params">Collision collision</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (collision.gameObject.tag == <span class="string">&quot;wall&quot;</span> &amp;&amp; collisionCounter &gt; <span class="number">0.2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			change = <span class="literal">true</span>;</span><br><span class="line">			collisionCounter = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (collision.gameObject.tag == <span class="string">&quot;player&quot;</span> &amp;&amp; hitCounter &gt; <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			Hit();</span><br><span class="line">			followManager.stop = <span class="literal">true</span>;</span><br><span class="line">			hitCounter = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnCollisionEnter</span>(<span class="params">Collision collision</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (collision.gameObject.tag == <span class="string">&quot;wall&quot;</span> &amp;&amp; collisionCounter &gt; <span class="number">0.2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			change = <span class="literal">true</span>;</span><br><span class="line">			collisionCounter = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (collision.gameObject.tag == <span class="string">&quot;player&quot;</span> &amp;&amp; hitCounter &gt; <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			Hit();</span><br><span class="line">			followManager.stop = <span class="literal">true</span>;</span><br><span class="line">			hitCounter = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		hitCounter = (hitCounter + Time.deltaTime) &gt; <span class="number">5</span> ? <span class="number">5</span> : hitCounter + Time.deltaTime;</span><br><span class="line">		collisionCounter = (collisionCounter + Time.deltaTime) &gt; <span class="number">5</span> ? <span class="number">5</span> : collisionCounter + Time.deltaTime;</span><br><span class="line">		<span class="keyword">if</span> (followManager.stop &amp;&amp; !IsName(<span class="string">&quot;Z_Attack&quot;</span>))</span><br><span class="line">			followManager.stop = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>FollowManager<br>  FollowManager实质上并不是Monster专属，而是FollowPlayerAction专属，主要是携带跟随信息，除了Monster以外主摄像头也会附带该部件以跟随玩家，为了方便(因为摄像头不在解释范围内)起见将其归为Monster  </p>
<h5 id="4-FollowManager-cs"><a href="#4-FollowManager-cs" class="headerlink" title="4.FollowManager.cs"></a>4.FollowManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FollowManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> followable;         <span class="comment">//是否可跟随</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> stop;               <span class="comment">//是否暂停</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> lookat;             <span class="comment">//是否朝向玩家</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> speed;             <span class="comment">//跟随速度</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		followable = <span class="literal">true</span>;</span><br><span class="line">		lookat = <span class="literal">true</span>;</span><br><span class="line">		stop = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>MonsterFactory<br>  MonsterFactory是怪兽工厂，提供怪兽的生成和释放操作   </p>
<h5 id="5-MonsterFactory-cs"><a href="#5-MonsterFactory-cs" class="headerlink" title="5.MonsterFactory.cs"></a>5.MonsterFactory.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonsterFactory</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> GameObject monster_Prefab;</span><br><span class="line"></span><br><span class="line">	List&lt;MonsterManager&gt; used;</span><br><span class="line">	List&lt;MonsterManager&gt; free;</span><br><span class="line">	Vector3[] areaPositions;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		used = <span class="keyword">new</span> List&lt;MonsterManager&gt;();</span><br><span class="line">		free = <span class="keyword">new</span> List&lt;MonsterManager&gt;();</span><br><span class="line">		monster_Prefab = GameObject.Instantiate&lt;GameObject&gt;(Resources.Load&lt;GameObject&gt;(<span class="string">&quot;Prefabs/Zombie1&quot;</span>), Vector3.zero, Quaternion.identity);</span><br><span class="line">		monster_Prefab.SetActive(<span class="literal">false</span>);</span><br><span class="line">		areaPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">9</span>, <span class="number">0.5f</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">9</span>, <span class="number">0.5f</span>, <span class="number">-9</span>), <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0.5f</span>, <span class="number">-9</span>), <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0.5f</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0.5f</span>, <span class="number">9</span>), <span class="keyword">new</span> Vector3(<span class="number">-9</span>, <span class="number">0.5f</span>, <span class="number">-9</span>), <span class="keyword">new</span> Vector3(<span class="number">-9</span>, <span class="number">0.5f</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">-9</span>, <span class="number">0.5f</span>, <span class="number">9</span>)&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//生成Monster</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> GameObject <span class="title">GetMonster</span>(<span class="params"><span class="keyword">int</span> area</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		GameObject monster;</span><br><span class="line">		<span class="keyword">if</span> (free.Count &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			monster = free[<span class="number">0</span>].gameObject;</span><br><span class="line">			free.Remove(free[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			monster = GameObject.Instantiate&lt;GameObject&gt;(monster_Prefab, Vector3.zero, Quaternion.identity);</span><br><span class="line">			monster.AddComponent&lt;FollowManager&gt;();</span><br><span class="line">			monster.AddComponent&lt;MonsterManager&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		monster.SetActive(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (area &lt; <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			monster.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">			monster.GetComponent&lt;FollowManager&gt;().speed = <span class="number">0.8f</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (area == <span class="number">4</span>||area == <span class="number">5</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			monster.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">			monster.GetComponent&lt;FollowManager&gt;().speed = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			monster.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">			monster.GetComponent&lt;FollowManager&gt;().speed = <span class="number">1.2f</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		monster.transform.position = areaPositions[area];</span><br><span class="line">		used.Add(monster.GetComponent&lt;MonsterManager&gt;());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> monster;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放Monster</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeMonster</span>(<span class="params">GameObject monster</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">foreach</span> (MonsterManager monsterManger <span class="keyword">in</span> used)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (monsterManger.gameObject.GetInstanceID() == monster.GetInstanceID())</span><br><span class="line">			&#123;</span><br><span class="line">				monster.GetComponent&lt;FollowManager&gt;().followable = <span class="literal">false</span>;</span><br><span class="line">				monster.GetComponent&lt;MonsterManager&gt;().moveable = <span class="literal">false</span>;</span><br><span class="line">				monster.SetActive(<span class="literal">false</span>);</span><br><span class="line">				free.Add(monsterManger);</span><br><span class="line">				used.Remove(monsterManger);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放所有Monster</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">while</span> (used.Count != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			used[<span class="number">0</span>].gameObject.GetComponent&lt;FollowManager&gt;().followable = <span class="literal">false</span>;</span><br><span class="line">			used[<span class="number">0</span>].moveable = <span class="literal">false</span>;</span><br><span class="line">			used[<span class="number">0</span>].gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">			free.Add(used[<span class="number">0</span>]);</span><br><span class="line">			used.Remove(used[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>AreaController<br>  AreaController负责控制各区域Monster的行为，提供一些订阅操作<br>  当玩家进入某个区域时，唤醒该区域的怪兽并发布追击<br>  当玩家不在区域内时，发布巡逻事件   <h5 id="6-AreaController-cs"><a href="#6-AreaController-cs" class="headerlink" title="6.AreaController.cs"></a>6.AreaController.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AreaController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">FollowAction</span>(<span class="params">GameObject follower, <span class="keyword">float</span> distanceAway, <span class="keyword">float</span> distanceUp, <span class="keyword">float</span> speed</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MonsterMoveAction</span>(<span class="params">GameObject monster, <span class="keyword">float</span> speed</span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> FollowAction followAction;              <span class="comment">//跟随事件发布</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> MonsterMoveAction monsterMoveAction;    <span class="comment">//巡逻事件发布</span></span><br><span class="line"></span><br><span class="line">	MonsterFactory monsterFactory;</span><br><span class="line">	GameObject[] monsters;</span><br><span class="line">	<span class="keyword">int</span> playerArea;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		monsterFactory = Singleton&lt;MonsterFactory&gt;.Instance;</span><br><span class="line">		playerArea = <span class="number">-1</span>;</span><br><span class="line">		monsters = <span class="keyword">new</span> GameObject[<span class="number">8</span>];</span><br><span class="line">		GameStart();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//游戏开始，初始化Monster</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GameStart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> temp = <span class="number">0</span>; temp &lt; <span class="number">8</span>; temp++)</span><br><span class="line">		&#123;</span><br><span class="line">			monsters[temp] = monsterFactory.GetMonster(temp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置玩家区域</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetArea</span>(<span class="params"><span class="keyword">int</span> area</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		playerArea = area;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetArea</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> playerArea;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放所有Monster</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		monsterFactory.FreeAll();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> temp = <span class="number">0</span>; temp &lt; <span class="number">8</span>; temp++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (!monsters[temp].activeSelf)</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="comment">//当玩家进入区域时，唤醒该区域的Monster，使其追击玩家，否则巡逻</span></span><br><span class="line">			<span class="keyword">if</span> (temp == playerArea &amp;&amp; monsters[temp].GetComponent&lt;FollowManager&gt;().followable == <span class="literal">false</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				monsters[temp].GetComponent&lt;MonsterManager&gt;().moveable = <span class="literal">false</span>;</span><br><span class="line">				monsters[temp].GetComponent&lt;MonsterManager&gt;().SetSpeed(monsters[temp].GetComponent&lt;FollowManager&gt;().speed);</span><br><span class="line">				followAction(monsters[temp], <span class="number">0</span>, <span class="number">0</span>, monsters[temp].GetComponent&lt;FollowManager&gt;().speed);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (temp != playerArea)</span><br><span class="line">			&#123;</span><br><span class="line">				monsters[temp].GetComponent&lt;FollowManager&gt;().followable = <span class="literal">false</span>;</span><br><span class="line">				monsters[temp].GetComponent&lt;MonsterManager&gt;().SetSpeed(<span class="number">0.5f</span>);</span><br><span class="line">				monsterMoveAction(monsters[temp], <span class="number">0.5f</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="地图管理"><a href="#地图管理" class="headerlink" title="地图管理"></a><strong>地图管理</strong></h3><ul>
<li>DetectPlace<br>  探测玩家移动区域，当玩家移动到该区域时发布区域事件<h5 id="7-DetectPlace-cs"><a href="#7-DetectPlace-cs" class="headerlink" title="7.DetectPlace.cs"></a>7.DetectPlace.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DetectPlace</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">SetArea</span>(<span class="params"><span class="keyword">float</span> x, <span class="keyword">float</span> y</span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> SetArea setArea;                  <span class="comment">//区域事件发布</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTriggerStay</span>(<span class="params">Collider other</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (other.gameObject.tag == <span class="string">&quot;player&quot;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			setArea(transform.position.x, transform.position.z);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="动作管理"><a href="#动作管理" class="headerlink" title="动作管理"></a><strong>动作管理</strong></h3><ul>
<li><p>FollowPlayerManager<br>  跟随玩家事件，用于实现摄像头跟随和怪兽追击<br>  跟随逻辑借鉴了网上的一部分代码 </p>
<h5 id="8-FollowPlayerManager-cs"><a href="#8-FollowPlayerManager-cs" class="headerlink" title="8.FollowPlayerManager.cs"></a>8.FollowPlayerManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FollowPlayerAction</span> : <span class="title">SSAction</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">float</span> distanceAway;             <span class="comment">//与玩家的水平距离</span></span><br><span class="line">	<span class="keyword">float</span> distanceUp;               <span class="comment">//与玩家的垂直距离</span></span><br><span class="line">	<span class="keyword">float</span> speed;                    <span class="comment">//跟随速度</span></span><br><span class="line"></span><br><span class="line">	Vector3 targetPosition;</span><br><span class="line"></span><br><span class="line">	Transform player;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//生产函数(工厂模式)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FollowPlayerAction <span class="title">GetSSAction</span>(<span class="params"><span class="keyword">float</span> distanceAway, <span class="keyword">float</span> distanceUp, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		FollowPlayerAction action = ScriptableObject.CreateInstance&lt;FollowPlayerAction&gt;();</span><br><span class="line">		action.distanceAway = distanceAway;</span><br><span class="line">		action.distanceUp = distanceUp;</span><br><span class="line">		action.speed = speed;</span><br><span class="line">		<span class="keyword">return</span> action;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		player = GameObject.FindWithTag(<span class="string">&quot;player&quot;</span>).transform;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (gameObject.GetComponent&lt;FollowManager&gt;().followable)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (gameObject.GetComponent&lt;FollowManager&gt;().stop)</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			targetPosition = player.position + Vector3.up * distanceUp + (gameObject.GetComponent&lt;FollowManager&gt;().lookat ? -player.forward * distanceAway : player.forward * distanceAway);</span><br><span class="line">			transform.position = Vector3.MoveTowards(transform.position, targetPosition, Time.deltaTime * speed * <span class="number">1.6f</span>);</span><br><span class="line">			transform.LookAt(player);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>.destroy = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">this</span>.enable = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">this</span>.callback.SSActionEvent(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>MoveMonsterAction<br>  Monster的巡逻事件<br>  每次往前移动一段距离<br>  当移动了3s后随机旋转45-135度，这样monster的行走路径就是3-8边形(平均4边形)</p>
<h5 id="9-MoveMonsterAction-cs"><a href="#9-MoveMonsterAction-cs" class="headerlink" title="9.MoveMonsterAction.cs"></a>9.MoveMonsterAction.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveMonsterAction</span> : <span class="title">SSAction</span></span><br><span class="line">&#123;</span><br><span class="line">	MonsterManager monsterManager;</span><br><span class="line">	<span class="keyword">float</span> speed;                    <span class="comment">//速度</span></span><br><span class="line">	<span class="keyword">float</span> counter;                  <span class="comment">//计数器</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MoveMonsterAction <span class="title">GetSSAction</span>(<span class="params"><span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		MoveMonsterAction action = ScriptableObject.CreateInstance&lt;MoveMonsterAction&gt;();</span><br><span class="line">		action.speed = speed;</span><br><span class="line">		<span class="keyword">return</span> action;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		counter = <span class="number">0</span>;</span><br><span class="line">		monsterManager = gameObject.GetComponent&lt;MonsterManager&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (monsterManager.moveable)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (monsterManager.stop)</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			counter += Time.deltaTime;</span><br><span class="line">			<span class="comment">//向前移动一段距离</span></span><br><span class="line">			gameObject.transform.Translate(<span class="number">0</span>, <span class="number">0</span>, speed * <span class="number">2.6f</span> * Time.deltaTime);</span><br><span class="line">			<span class="comment">//每3s换一个方向</span></span><br><span class="line">			<span class="keyword">if</span> (counter &gt; <span class="number">3</span> || monsterManager.change)</span><br><span class="line">			&#123;</span><br><span class="line">				monsterManager.change = <span class="literal">false</span>;</span><br><span class="line">				gameObject.transform.Rotate(<span class="number">0</span>, Random.Range(<span class="number">45</span>, <span class="number">135</span>), <span class="number">0</span>);</span><br><span class="line">				counter = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>.destroy = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">this</span>.enable = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">this</span>.callback.SSActionEvent(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>MovePlayerAction<br>  玩家的移动动作<br>  为玩家速度提供缓冲，不允许直接加速到满值，当速度&gt;0.7时进行计数，1.5s内最高0.7，这样玩家就会出现先走路再跑步的动画<br>  当玩家后退时，将玩家旋转180度且不让摄像头面向玩家，这样游戏界面就能看到玩家正面了</p>
<h5 id="10-MovePlayerAction-cs"><a href="#10-MovePlayerAction-cs" class="headerlink" title="10.MovePlayerAction.cs"></a>10.MovePlayerAction.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MovePlayerAction</span> : <span class="title">SSAction</span></span><br><span class="line">&#123;</span><br><span class="line">	PlayerManager playerManager;</span><br><span class="line">	<span class="keyword">float</span> counter;                  <span class="comment">//计数器</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//生产函数(工厂模式)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovePlayerAction <span class="title">GetSSAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		MovePlayerAction action = ScriptableObject.CreateInstance&lt;MovePlayerAction&gt;();</span><br><span class="line">		<span class="keyword">return</span> action;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		playerManager = gameObject.GetComponent&lt;PlayerManager&gt;();</span><br><span class="line">		counter = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (playerManager.moveable)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">float</span> speed = playerManager.speed;</span><br><span class="line">			<span class="comment">//玩家后退时将玩家旋转180度并让摄像头不再面向玩家</span></span><br><span class="line">			<span class="keyword">if</span> (speed &lt; <span class="number">-0.1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				speed = -speed;</span><br><span class="line">				<span class="keyword">if</span> (GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>).GetComponent&lt;FollowManager&gt;().lookat)</span><br><span class="line">				&#123;</span><br><span class="line">					gameObject.transform.Rotate(<span class="number">0</span>, <span class="number">180</span>, <span class="number">0</span>);</span><br><span class="line">					GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>).GetComponent&lt;FollowManager&gt;().lookat = <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (speed &gt; <span class="number">0.1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (!GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>).GetComponent&lt;FollowManager&gt;().lookat)</span><br><span class="line">				&#123;</span><br><span class="line">					gameObject.transform.Rotate(<span class="number">0</span>, <span class="number">180</span>, <span class="number">0</span>);</span><br><span class="line">					GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>).GetComponent&lt;FollowManager&gt;().lookat = <span class="literal">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//速度&gt;0.7时增加计数器，1.5s后转为跑步速度，否则最高为0.7</span></span><br><span class="line">			<span class="keyword">if</span> (speed &gt;= <span class="number">0.7</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				counter = (counter + Time.deltaTime) &gt; <span class="number">1.5f</span> ? <span class="number">1.5f</span> : counter + Time.deltaTime;</span><br><span class="line">				speed = counter == <span class="number">1.5f</span> ? speed : <span class="number">0.7f</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				counter = (counter - Time.deltaTime) &lt; <span class="number">0</span> ? <span class="number">0</span> : counter - Time.deltaTime;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//向前移动</span></span><br><span class="line">			gameObject.transform.Translate(<span class="number">0</span>, <span class="number">0</span>, speed * <span class="number">3.6f</span> * Time.deltaTime);</span><br><span class="line">			playerManager.speed = playerManager.speed &gt; <span class="number">0</span> ? playerManager.speed - Time.deltaTime : playerManager.speed + Time.deltaTime;</span><br><span class="line">			<span class="comment">//进行旋转</span></span><br><span class="line">			gameObject.transform.Rotate(<span class="number">0</span>, playerManager.direction * <span class="number">70</span> * Time.deltaTime, <span class="number">0</span>);</span><br><span class="line">			playerManager.direction = <span class="number">0</span>;</span><br><span class="line">			<span class="comment">//设置玩家状态机速度</span></span><br><span class="line">			playerManager.SetSpeed(speed);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>.destroy = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">this</span>.enable = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">this</span>.callback.SSActionEvent(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>CCActionManager<br>  动作管理者，主要是为传入的对象添加动作  </p>
<h5 id="11-CCActionManager-cs"><a href="#11-CCActionManager-cs" class="headerlink" title="11.CCActionManager.cs"></a>11.CCActionManager.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CCActionManager</span> : <span class="title">SSActionManager</span>, <span class="title">ISSActionCallback</span>, <span class="title">IActionManager</span></span><br><span class="line">&#123;</span><br><span class="line">	FollowPlayerAction follow;</span><br><span class="line">	MovePlayerAction movePlayer;</span><br><span class="line">	MoveMonsterAction monsterAction;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> new <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//移动玩家</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MovePlayer</span>(<span class="params">GameObject player, <span class="keyword">float</span> speed, <span class="keyword">float</span> direction</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		PlayerManager playerManager = player.GetComponent&lt;PlayerManager&gt;();</span><br><span class="line">		<span class="keyword">if</span> (playerManager == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		playerManager.speed = speed;</span><br><span class="line">		playerManager.direction = direction;</span><br><span class="line">		<span class="keyword">if</span> (!playerManager.moveable)</span><br><span class="line">		&#123;</span><br><span class="line">			playerManager.moveable = <span class="literal">true</span>;</span><br><span class="line">			movePlayer = MovePlayerAction.GetSSAction();</span><br><span class="line">			RunAction(player, movePlayer, <span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//跟随玩家</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FollowPlayer</span>(<span class="params">GameObject follower, <span class="keyword">float</span> distanceAway, <span class="keyword">float</span> distanceUp, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		FollowManager followManager = follower.GetComponent&lt;FollowManager&gt;();</span><br><span class="line">		<span class="keyword">if</span> (followManager == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (!followManager.followable)</span><br><span class="line">		&#123;</span><br><span class="line">			followManager.followable = <span class="literal">true</span>;</span><br><span class="line">			follow = FollowPlayerAction.GetSSAction(distanceAway, distanceUp, speed);</span><br><span class="line">			RunAction(follower, follow, <span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//巡逻</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveMonster</span>(<span class="params">GameObject monster, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		MonsterManager monsterManager = monster.GetComponent&lt;MonsterManager&gt;();</span><br><span class="line">		<span class="keyword">if</span> (monsterManager == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (!monsterManager.moveable)</span><br><span class="line">		&#123;</span><br><span class="line">			monsterManager.moveable = <span class="literal">true</span>;</span><br><span class="line">			monsterAction = MoveMonsterAction.GetSSAction(speed);</span><br><span class="line">			RunAction(monster, monsterAction, <span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//回调函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SSActionEvent</span>(<span class="params">SSAction source,</span></span></span><br><span class="line"><span class="function"><span class="params">	SSActionEventType events = SSActionEventType.Competed,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> intParam = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">string</span> strParam = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	Object objectParam = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="主控制"><a href="#主控制" class="headerlink" title="主控制"></a><strong>主控制</strong></h3><ul>
<li>FirstController<br>  主控制器，负责资源初始化与协调各模块的工作<br>  与其他5个模块通信，订阅其他模块发布的事件并进行处理<br>  接收玩家交互后产生的信息并进行相应处理  <h5 id="12-FirstController-cs"><a href="#12-FirstController-cs" class="headerlink" title="12.FirstController.cs"></a>12.FirstController.cs</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FirstController</span> : <span class="title">MonoBehaviour</span>, <span class="title">ISceneController</span>, <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">	GameObject map;                     <span class="comment">//地图管理</span></span><br><span class="line">	GameObject player;                  <span class="comment">//玩家管理</span></span><br><span class="line">	UserGUI userGUI;                    <span class="comment">//用户交互</span></span><br><span class="line">	IActionManager actionManager;       <span class="comment">//动作管理</span></span><br><span class="line">	AreaController areaController;      <span class="comment">//怪兽管理</span></span><br><span class="line">	<span class="keyword">float</span> survivetime = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// Start is called before the first frame update</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		SSDirector.GetInstance().CurrentScenceController = <span class="keyword">this</span>;</span><br><span class="line">		gameObject.AddComponent&lt;MonsterFactory&gt;();</span><br><span class="line">		gameObject.AddComponent&lt;AreaController&gt;();</span><br><span class="line">		areaController = Singleton&lt;AreaController&gt;.Instance;</span><br><span class="line">		gameObject.AddComponent&lt;CCActionManager&gt;();</span><br><span class="line">		gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">		userGUI = Singleton&lt;UserGUI&gt;.Instance;</span><br><span class="line">		actionManager = Singleton&lt;CCActionManager&gt;.Instance;</span><br><span class="line">		LoadResources();</span><br><span class="line">		GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>).AddComponent&lt;FollowManager&gt;();</span><br><span class="line">		actionManager.FollowPlayer(GameObject.FindWithTag(<span class="string">&quot;MainCamera&quot;</span>), <span class="number">3.5f</span>, <span class="number">5f</span>, <span class="number">6</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//订阅各事件</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		AreaController.followAction += FollowAction;</span><br><span class="line">		AreaController.monsterMoveAction += MonsterMoveAction;</span><br><span class="line">		PlayerManager.dealDamage += DealPlayerDamage;</span><br><span class="line">		DetectPlace.setArea += SetArea;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取消订阅</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		AreaController.followAction -= FollowAction;</span><br><span class="line">		AreaController.monsterMoveAction -= MonsterMoveAction;</span><br><span class="line">		PlayerManager.dealDamage -= DealPlayerDamage;</span><br><span class="line">		DetectPlace.setArea -= SetArea;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//加载资源</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadResources</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (map == <span class="literal">null</span>)</span><br><span class="line">			map = GameObject.Instantiate&lt;GameObject&gt;(Resources.Load&lt;GameObject&gt;(<span class="string">&quot;Prefabs/map&quot;</span>), Vector3.zero, Quaternion.identity);</span><br><span class="line">		<span class="keyword">if</span> (player == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			player = GameObject.Instantiate&lt;GameObject&gt;(Resources.Load&lt;GameObject&gt;(<span class="string">&quot;Prefabs/MaleFree1&quot;</span>), Vector3.zero, Quaternion.identity);</span><br><span class="line">			player.AddComponent&lt;PlayerManager&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		player.GetComponent&lt;PlayerManager&gt;().health = <span class="number">3</span>;</span><br><span class="line">		userGUI.SetPlayerHealth(<span class="number">3</span>);</span><br><span class="line">		userGUI.SetPoints(<span class="number">0</span>);</span><br><span class="line">		player.transform.position = <span class="keyword">new</span> Vector3(<span class="number">9</span>, <span class="number">0.5f</span>, <span class="number">9</span>);</span><br><span class="line">		actionManager.MovePlayer(player, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理玩家受伤事件</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DealPlayerDamage</span>(<span class="params">GameObject sender</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		userGUI.SetPlayerHealth(sender.GetComponent&lt;PlayerManager&gt;().health);</span><br><span class="line">		<span class="keyword">if</span> (sender.GetComponent&lt;PlayerManager&gt;().health == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			areaController.FreeAll();</span><br><span class="line">			sender.GetComponent&lt;PlayerManager&gt;().moveable = <span class="literal">false</span>;</span><br><span class="line">			userGUI.gameOver = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//玩家移动</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MovePlayer</span>(<span class="params"><span class="keyword">float</span> speed, <span class="keyword">float</span> direction</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (player.GetComponent&lt;PlayerManager&gt;().moveable)</span><br><span class="line">			actionManager.MovePlayer(player, speed, direction);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理怪兽追击事件</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FollowAction</span>(<span class="params">GameObject follower, <span class="keyword">float</span> distanceAway, <span class="keyword">float</span> distanceUp, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		actionManager.FollowPlayer(follower, distanceAway, distanceUp, speed);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理怪兽巡逻事件</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MonsterMoveAction</span>(<span class="params">GameObject monster, <span class="keyword">float</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		actionManager.MoveMonster(monster, speed);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//游戏重开</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		LoadResources();</span><br><span class="line">		player.GetComponent&lt;PlayerManager&gt;().Revive();</span><br><span class="line">		areaController.GameStart();</span><br><span class="line">		userGUI.gameOver = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置玩家区域</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetArea</span>(<span class="params"><span class="keyword">float</span> x, <span class="keyword">float</span> y</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">int</span> playerArea = <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">if</span> (x &gt; <span class="number">4.5f</span> &amp;&amp; y &gt; <span class="number">4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">4.5f</span> &amp;&amp; y &gt; <span class="number">-4.5f</span> &amp;&amp; y &lt; <span class="number">4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">4.5f</span> &amp;&amp; y &lt; <span class="number">-4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">4.5f</span> &amp;&amp; x &gt; <span class="number">-4.5f</span> &amp;&amp; y &lt; <span class="number">-4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">4.5f</span> &amp;&amp; x &gt; <span class="number">-4.5f</span> &amp;&amp; y &lt; <span class="number">4.5f</span> &amp;&amp; y &gt; <span class="number">-4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">3</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">4.5f</span> &amp;&amp; x &gt; <span class="number">-4.5f</span> &amp;&amp; y &gt; <span class="number">4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">4</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">-4.5f</span> &amp;&amp; y &lt; <span class="number">-4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">5</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">-4.5f</span> &amp;&amp; y &gt; <span class="number">-4.5f</span> &amp;&amp; y &lt; <span class="number">4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">6</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">-4.5f</span> &amp;&amp; y &gt; <span class="number">4.5f</span>)</span><br><span class="line">			playerArea = <span class="number">7</span>;</span><br><span class="line">		areaController.SetArea(playerArea);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span>(areaController.GetArea() != <span class="number">-1</span>)</span><br><span class="line">		survivetime += Time.deltaTime;</span><br><span class="line">		<span class="keyword">if</span>(survivetime &gt; <span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			userGUI.AddPoints(<span class="number">1</span>);</span><br><span class="line">			survivetime = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_20549085/article/details/102798334">参考博客</a></p>
<h4 id="个人修改重制部分"><a href="#个人修改重制部分" class="headerlink" title="个人修改重制部分"></a>个人修改重制部分</h4><pre><code>重制了地图，替换了模型
简化了操作，玩家只可水平移动，只可躲避怪物无法攻击
在出生点区域外每游玩一秒计一分，被僵尸攻击命中三次时游戏结束</code></pre>
<p>02 Dec 2021</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/" data-id="ckwodjhps0000icv584sm3fjm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">与游戏世界交互&amp;物理系统与碰撞-作业4</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%AF%BC%E8%AE%BA/">软件工程导论</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/02/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-12-02-homework5/">模型与动画-作业5</a>
          </li>
        
          <li>
            <a href="/2021/10/25/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-25-homework4/">与游戏世界交互&amp;物理系统与碰撞-作业4</a>
          </li>
        
          <li>
            <a href="/2021/10/16/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-16-homework3/">游戏对象与图形基础-作业3</a>
          </li>
        
          <li>
            <a href="/2021/10/06/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-10-06-homework2/">游戏对象与图形基础-作业2</a>
          </li>
        
          <li>
            <a href="/2021/09/18/3D%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/2021-09-18-homework1/">离散仿真引擎基础-作业1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 殷轲<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>